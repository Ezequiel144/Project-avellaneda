---
import PerfilUser from "../../components/UserId/PerfilUser/PerfilUser.astro";
//import listBusinesses from "../../data/business.data.json";
import type { BusinessItemUserId } from "../../interface/business";
import Layout from "../../layouts/Layout.astro";
import { strapiFetch } from "../../utils/fetch";
import { marked } from "marked";

/* const { URL_STRAPI } = envVariants(); */

export async function getStaticPaths() {
  const res = await strapiFetch(
    "/businesses?populate[imagelogo][fields][0]=url&populate=galery&populate[frontpage][fields][0]=url&populate[tags]=*&populate[linksbuttons]=*&populate[socialmedia]=*",
    {
      method: "GET",
    }
  );
  const listBusinesses = res.data;
  //console.log(listBusinesses);
  return listBusinesses.map((item: BusinessItemUserId) => {
    return {
      params: { id: item.title },
      props: { currentBusiness: item },
    };
  });
}

const { currentBusiness } = Astro.props as {
  currentBusiness: BusinessItemUserId;
};
/* const currentBusiness = listBusinesses
  ? listBusinesses.find((item: Business) => item.id === _id)
  : null; */

//console.log(currentBusiness ? currentBusiness : "Business not found");
---

<Layout>
  {
    currentBusiness ? (
      <section class="size-full flex flex-col gap-y-9">
        <article class="h-[590px] w-full">
          <img
            src={`${currentBusiness.frontpage.url}`}
            alt="imagen-front"
            class="size-full object-cover -z-10"
            onerror="this.onerror=null; this.src='/image/no-image.png';"
          />
        </article>
        <PerfilUser
          imageLogo={currentBusiness.imagelogo.url}
          title={currentBusiness.title}
          tags={currentBusiness.tags}
          socialMedia={currentBusiness.socialmedia}
          galery={currentBusiness.galery || undefined}
        />
        <article class="mx-auto w-full max-w-[1200px] flex flex-col gap-y-9">
          <div class="w-full">
            <div
              class="long-description"
              set:html={marked(currentBusiness.longdescription)}
            />
          </div>
          <div class={`flex gap-4 w-full `}>
            {currentBusiness.linksbuttons.map((item) => (
              <a
                href={item.link}
                class={`${currentBusiness.linksbuttons.length === 1 ? "w-full" : currentBusiness.linksbuttons.length === 2 ? "w-1/2" : "w-1/3"} rounded-xl bg-red-500 text-white text-center px-4 py-3 text-xl font-semibold`}
              >
                {item.title}
              </a>
            ))}
          </div>
        </article>
      </section>
    ) : (
      <h1>Business not found</h1>
    )
  }
</Layout>

<style>
  .long-description {
    font-size: 1rem;
    list-style: circle;
  }

  .long-description ul li {
    font-size: 1rem;
    line-height: 1.5;
    list-style: circle;
  }
</style>
